<html>
<head>
   <title> Profile Page</title>
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <link rel="shortcut icon" type="image/png" href="../App Home/assets/logo/logo_transparent.png">

   <!-- Bootstrap -->
   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
   <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css" rel="stylesheet">
   <!-- Font Awesome Library -->
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css"/> 

   <!-- Custom CSS -->
   <link rel="stylesheet" href="../App Home/style.css">

   <!-- Google Fonts Fonts -->
   <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<style>
 button{cursor:pointer;}
 div.pr{position:absolute;
        z-index:9;
        left:15%;
        border:1px solid black;
        width: 72.6vw;   
      }
   .pri{cursor:pointer;
        border:1px solid black;
        border-bottom-left-radius:10%;
        border-bottom-right-radius:10%;
        width: 72.6vw;}
   .prp{position: absolute;
        left:2%;
        top:45%;
        cursor:pointer;
       border:1px solid black;
       border-radius:50%;
       background-color:white;}   
   div.popupload{position:absolute;
                 top:30%;
                 left:30%;
                 width:50%;
                 border:1px solid black;
                 height:50%;
                 z-index:10;
                 border-radius:15px;
                 padding:8px;
                 background-color:white;
                 visibility:hidden;}
      .uploadbtn{cursor:pointer;
                 position:absolute;
                 left:35%;
                 top:40%;
                 width:30%;
                 height:20%;
                 background-color:green;}   
   .name{position:relative;
         left:20%;} 
   .job{position:relative;
        left:20%;
        font-size:20px;}
   .city{position:relative;
         left:20%;
         font-size:20px;
         box-sizing: border-box;
         width: 100%;   
      }
   .rating1{position:relative;
           left:20%;
           color:orange;}
   .rating2{position:relative;
           left:22%;
           color:orange;}
   .rating3{position:relative;
           left:24%;
           color:orange;}
   .rating4{position:relative;
           left:26%;}
   .rating5{position:relative;
           left:28%;}
div.bio{position:absolute;
        top:80%;
        left:17%;
        height:50%;
        width:20%;
        border:1px solid black;
        border-radius:8px;
        font-size:20px;
        padding:10px;}
   div.popbio{position:absolute;
                 top:30%;
                 left:40%;
                 width:30%;
                 border:1px solid black;
                 height:50%;
                 z-index:10;
                 border-radius:15px;
                 padding:8px;
                 background-color:white;
                 font-size:20px;
                 visibility:hidden;}
div.posts{position:absolute;
          top:80%;
          left:40%;
          width:55%;}
    .post{position:absolute;
          width:88%;
          font-size:20px;
          border:1px solid black;
          border-radius:5px;}
div.comments{position:fixed;
             left:15%;
             z-index:9;
             background-color:yellow;
             width:74%;
             height:10%;
             top:90%;
             border-top: 1px solid black;
             border-left:1px solid black;
             border-right:1px solid black;
             font-size:20px;
             transition:0.5s;}
   .exp{font-size:15px;
        cursor:pointer;
        width:5%;
        color:blue;}
   div.comment{position:relative;
               max-height: 100px;
               overflow-y:scroll;}
</style>
</head>
<body>

   <header class="bg-dark" data-bs-theme="dark">
      <span id="brand_name">
         <h1>मेरा स्थानीय</h1>
      </span>
      <img src="../App Home/assets/logo/logo.png"  class="img-thumbnail" id="logo" alt="Logo">
      <span id="brand_name">
        <h1>My Local</h1>
      </span>
   </header>
   <nav class="navbar navbar-dark navbar-expand-lg bg-dark fixed" data-bs-theme="dark">
      <div class="container-fluid">
         <a class="navbar-brand d-flex align-items-center justify-content-center flex-column" id="profile_nav" href="#">
            <span><i class="bi bi-person-circle"></i></span>
            <span>Profile</span>
         </a>
         <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasDarkNavbar" aria-controls="offcanvasDarkNavbar">
            <span class="navbar-toggler-icon"></span>
         </button>
         <div class="offcanvas offcanvas-end text-bg-dark" tabindex="-1" id="offcanvasDarkNavbar" aria-labelledby="offcanvasDarkNavbarLabel">
            <div class="offcanvas-header">
               <h5 class="offcanvas-title" id="offcanvasDarkNavbarLabel">Profile</h5>
               <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
            </div>
            <div class="offcanvas-body">
               <ul class="navbar-nav justify-content-around flex-grow-1 pe-3">
                  <li class="nav-item" id="home_nav">
                     <a class="nav-link d-flex align-items-center justify-content-center flex-column" href="../index.html" role="button">
                        <span><i class="bi bi-house-door-fill"></i></span> 
                        <span>Home</span> 
                     </a>
                  </li>
                  <li class="nav-item" id="deals_nav">
                     <a class="nav-link d-flex align-items-center justify-content-center flex-column" href="deals.html" role="button">
                        <span><i class="bi bi-bag-fill"></i></i></span>
                        <span>Deals</span> 
                     </a>
                  </li>
                  <li class="nav-item" id="hiring_nav">
                     <a class="nav-link d-flex align-items-center justify-content-center flex-column" href="hiring.html" role="button">
                        <span><i class="bi bi-person-badge-fill"></i></span>
                        <span>Hiring</span>
                     </a>
                  </li>
                  <li class="nav-item" id="people_nav">
                     <a class="nav-link d-flex align-items-center justify-content-center flex-column" href="profile.html" role="button">
                        <span><i class="bi bi-people-fill"></i></span> 
                        <span>People</span>
                     </a>
                  </li>
                  <li class="nav-item" id="login_nav">
                     <a class="nav-link d-flex align-items-center justify-content-center flex-column" href="login.html" role="button">
                        <span><i class="bi bi-person-fill"></i></span>
                        <span>Login</span>
                     </a>
                  </li>
                  <li class="nav-item" id="signup_nav">
                     <a class="nav-link d-flex align-items-center justify-content-center flex-column" href="sarthak signup.html" role="button">
                        <span><i class="bi bi-person-plus-fill"></i></span>
                        <span>Sign Up</span>
                     </a>
                  </li>
                  <li class="nav-item" id="logout_nav">
                     <a class="nav-link d-flex align-items-center justify-content-center flex-column" role="button" onclick="logout()">
                        <span><i class="bi bi-power"></i></span>
                        <span>Logout</span>
                     </a>
                  </li>
               </ul>
            </div>
         </div>        
      </div>
   </nav>

   <section class="container-fluid" id="main_content">
      <form id="prof">
      <div id="uplod" class="popupload">
         <span onclick="uploadclos()" style="font-size:30px; cursor:pointer;">&times;</span>
         <input onclick="conf()" class="uploadbtn" type="submit" value="upload">
      </div>
      <div class="pr">
         <input type="file" id="coverph" accept="image/*" hidden>
         <input type="file" id="profileph" accept="image/*" hidden>
         <img id="coverimage" onclick="coverupload()" class="pri" src="https://s3.amazonaws.com/export.easil.com/4ffc1b2d-5384-404e-bcf9-e77f388b1f46/798e7a925e22c21006.png" width="1000px" height="250px">
         <img id="profimage" onclick="profileupload()" class="prp" src="https://cdn-icons-png.flaticon.com/512/1160/1160358.png" width="150px" height="150px">
         <h2 class="name" id="nam"> </h2>
         <i id="job" class="fa fa-briefcase job">&nbsp </i>
         <br>
         <div class="city">
         <i id="wcity" class="fa fa-building">&nbsp&nbsp</i>
         <i class="fa fa-star rating1"></i>
         <i class="fa fa-star rating2"></i>
         <i class="fa fa-star rating3"></i>
         <i class="fa fa-star rating4"></i>
         <i class="fa fa-star rating5"></i>
         </div>
      </div>
      </form>
      <div class="bio">
         <i class="fa fa-map-marker"> &nbsp From <b id="plac"></b></i>
         <br><br>
         <i class="fa fa-graduation-cap">&nbsp Completed <b id="edu"></b></i>
         <br><br>
         <i class="fa fa-suitcase"></i><sup><i style="font-size:10px;" class="fa fa-clock-o"></i></sup>&nbspExperience <b id="exper"></b>
         <br><br>
         <i class="fa fa-check-square-o">&nbsp&nbspCompleted <b id="taskcomp"> </b> Tasks</i>
         <br><br>
         <i class="fa fa-language">&nbsp Speaks <b id="langkn"> </b> </i>
         <br><br>
         <button onclick="addcont()">Update Details</button>
      </div>
      <div id="biodata" class="popbio">
      <span onclick="addcontclos()" style="font-size:30px; cursor:pointer;">&times;</span>
      <center>
         <b>From</b>
         <br>
         <input type="text" id="addlcton">
         <br>
         <b>Completed</b><br>
         <input type="text" id="addedu" placeholder="Education"><br>
         <b>Experience</b><br>
         <input type="text" id="addexp"><br>
         <b>Completed</b><br>
         <input type="text" id="addtask" placeholder="Number of Tasks"><br>
         <b>Speaks</b><br>
         <input type="text" id="addlang">
         <br><br>
      <div id="biod">
         <input type="submit" style="background-color:cyan; cursor:pointer;" value="Update">
      </div>
      </center> 
      </div>

      <div id="posts" class="posts">
         <div>
         <input id="postdesc" class="post" type="Text" placeholder="Describe and post your work"><br><br>
         <input type="file" id="postpic" accept="image/*, video/*" hidden>
         <button onclick="picpost()">Upload Photo/video</button>
         <br><br>
         <div id="postings">
            <input id="postupload" onclick="x()" type="submit" value="Upload Post">
         </div>
         <br>
         </div>
         
      </div>

      <div id="comm" class="comments">
      <center>
         <b>Customer Reviews and Ratings</b>
         <br>
         <i style="color:orange;" class="fa fa-star"></i>
         <i style="color:orange;" class="fa fa-star"></i>
         <i style="color:orange;" class="fa fa-star"></i>
         <i style="color:orange;" class="fa fa-star"></i>
         <i class="fa fa-star"></i>
         <br>
         <div id="expand" class="exp" onclick="comment()"><u>Expand</u></div>
         <div class="comment">
         </div>
      </center>
      </div>
   </section>

   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>
   <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
   <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
   <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" integrity="sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s" crossorigin="anonymous"></script>
<script>
function coverupload(){
     document.getElementById("coverph").click()
     fileupload()
}
function profileupload(){
     document.getElementById("profileph").click()
     fileupload()
}
function uploadclos(){
     document.getElementById("uplod").style.visibility="hidden"
     document.body.style.backgroundColor="white"
     document.getElementById("prtext").remove()
}
function comment(){
   if(document.getElementById("expand").innerText=="Expand"){
     document.getElementById("comm").style.top="75%"
     document.getElementById("comm").style.height="25%"
     document.getElementById("expand").innerText="Minimise"}
   else{
     document.getElementById("comm").style.top="90%"
     document.getElementById("comm").style.height="10%"
     document.getElementById("expand").innerText="Expand"}
   
}

function picpost(){
   document.getElementById("postpic").click()
}

function fileupload(){
   document.getElementById("uplod").style.visibility="visible"
   document.body.style.backgroundColor="grey"
}
function addcont(){
   document.getElementById("biodata").style.visibility="visible"
   document.body.style.backgroundColor="grey"
}
function addcontclos(){
   document.getElementById("biodata").style.visibility="hidden"
   document.body.style.backgroundColor="white"
} 
function conf(){
   if(document.getElementById("profileph").value=="" && document.getElementById("coverph").value==""){
        ab=document.createElement("p")
        ab.innerHTML="No file uploaded!"
        ab.id="prtext"
        ab.style.color="red"
        ab.style.position="absolute"
        ab.style.left="43%"
        ab.style.top="60%"
        document.getElementById("uplod").appendChild(ab)
   }
   else{document.body.style.backgroundColor="white"
        document.getElementById("uplod").style.visibility="hidden"
        alert("file uploaded")
   }
}

window.onscroll = function(ev) {
    if (((window.innerHeight + window.scrollY) >= document.body.offsetHeight)==true) {
      document.getElementById("comm").style.top="100%"
      document.getElementById("comm").style.height="0%"
    }
    pgtop()
}

function pgtop(){
   if(document.body.scrollTop === 0){
      document.getElementById("comm").style.top="90%"
      document.getElementById("comm").style.height="10%"                
   } 
}
</script>

<script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/7.14.1-0/firebase.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyB627a-ThWusMYiaPooK8R57UDkD2OdAp4",
  authDomain: "gsolution-240c6.firebaseapp.com",
  databaseURL: "https://gsolution-240c6-default-rtdb.firebaseio.com",
  projectId: "gsolution-240c6",
  storageBucket: "gsolution-240c6.appspot.com",
  messagingSenderId: "734513557996",
  appId: "1:734513557996:web:fe84d9214593159b1950c9"
};

firebase.initializeApp(firebaseConfig);
 document.getElementById('prof')
            .addEventListener('click', storeprof);


            var a="/profile/"+"profiles"+profilescount
 var messagesRef = firebase.database()
            .ref(a);
        document.getElementById('prof')
            .addEventListener('submit', submitForm);
        function submitForm(e) {
            e.preventDefault();
            // Get values
           if(document.getElementById("coverph").value==""){
             var primg=document.getElementById("profileph").files[0].name;
             var nameid= document.getElementById("nam").innerText;
             var prcount=profilescount;
            
            console.log(nameid);
 
            saveMessage(cimg,primg,nameid,prcount);}
            
           else if(document.getElementById("profileph").value==""){
             var cimg=document.getElementById("coverph").files[0].name;
             var nameid= document.getElementById("nam").innerText;
             var prcount=profilescount;
 
             saveMessage(cimg,primg,nameid,prcount);}   
           }            
        // Function to get form values
        function getInputVal(id) {
            return document.getElementById(id).value;
        }
        // Save message to firebase
        function saveMessage(cimg, primg, nameid, prcount) {
             
             /*var newMessageRef = messagesRef.push();*/
          if(document.getElementById("coverph").value==""){
            messagesRef.set({
                primage:primg, 
                name:nameid,
                count:prcount,
            });}
          else if(document.getElementById("profileph").value==""){
            messagesRef.update({
                cimage:cimg, 
                name:nameid,
                count:prcount,
            });}
       }}
function profret(){
countnum=0
countx=0;
var dataa=[]
datacount=0
function retrieved(){
qa=JSON.parse(window.localStorage.getItem('login'))
f=qa[0][1]+qa[0][0]

var ref = firebase.database().ref('/profile/'+'profiles'+datacount);
datacount+=1
ref.on("value", function(snapshot) {
   console.log(snapshot.val().name);
   m=snapshot.val().cimage
   n=snapshot.val().primage
   prcount=snapshot.val().count
   profilename=snapshot.val().name
   dataa.push([m,n])
   profil()
}, function (error) {
   console.log("Error: " + error.code);
});
}


qa=JSON.parse(window.localStorage.getItem('login'))
 f=qa[0][1]+qa[0][0]

var ref = firebase.database().ref('/profile/');
ref.on('child_added', function(snapshot) {
   countnum++;
  // how do I know if this is the last child? i.e. the count is complete?
});

ref.on('value', function(snapshot) {
countx+=countnum
profilescount=countnum

counter()
});
function counter(){
for(; datacount<=countx;){
retrieved()}}
}

function profil(){
qa=JSON.parse(window.localStorage.getItem('login'))
 f=qa[0][1]+qa[0][0]

if(profilename==f){
   document.getElementById("profimage").src=n
   document.getElementById("coverimage").src=m
   profilescount=prcount-1
}}
</script>

<script>
qa=JSON.parse(window.localStorage.getItem('login'))
 f=qa[0][1]+qa[0][0]

function x(){
var a="/posts/"+f+"/posts"+postin
var messagesRef = firebase.database()
            .ref(a);
        document.getElementById('postings')
            .addEventListener('click', submitForm);
        function submitForm(e) {
            e.preventDefault();
            // Get values
            var postcount=postin-1;
            var postimg=document.getElementById("postpic").files[0].name;
             var postcont=document.getElementById("postdesc").value
             var nameid= document.getElementById("nam").innerText;
            console.log(nameid);
           messagesRef.on("value", function(snapshot){
             if(snapshot.exists()){
           
             }
             else{
            saveMessage(postcount,postcont, postimg, nameid);
            }})}

        // Function to get form values
        function getInputVal(id) {
            return document.getElementById(id).value;
        }
        // Save message to firebase
        function saveMessage(postcount,postcont,postimg,nameid) {
            messagesRef.set({
                postcount:postcount,
                postimage:postimg,
                postcontent:postcont, 
                name:nameid,
            });}
postin+=1}

function allpost(){
countnum=0
countx=0;
const data=[];
postscount=0
function retrieve(){
qa=JSON.parse(window.localStorage.getItem('login'))
 f=qa[0][1]+qa[0][0]

var ref = firebase.database().ref('/posts/'+f+'/posts'+postscount);
postscount+=1
ref.on("value", function(snapshot) {
   console.log(snapshot.val().postcontent);
   g=snapshot.val().postcontent
   k=snapshot.val().postimage
   data.push([g,k])
   posting()
}, function (error) {
   console.log("Error: " + error.code);
});
}


qa=JSON.parse(window.localStorage.getItem('login'))
 f=qa[0][1]+qa[0][0]

var ref = firebase.database().ref('/posts/'+f);
ref.on('child_added', function(snapshot) {
   countnum++;
  // how do I know if this is the last child? i.e. the count is complete?
});

ref.on('value', function(snapshot) {
countx+=countnum
postin=countnum
counter()
});
function counter(){
for(; postscount<=countx;){
retrieve()}
bioret()}}


count=1
trcount=1
function posting(){
     tableid="postbox"+count
     trid1="imag"+trcount
     trid2="desc"+trcount
     a=document.createElement("table")
     a.id="postbox"+count
     a.style.border="1px solid black"
     a.style.borderRadius="8px"
     count+=1
     document.getElementById("posts").appendChild(a)
     b=document.createElement("tr")
     b.id="imag"+trcount
     document.getElementById(tableid).appendChild(b)
     c=document.createElement("td")
     d=document.createElement("img")
     d.style.border="1px solid black"
     d.style.borderRadius="8px"
     d.src=k
     d.style.width="640px"
     d.style.height="200px"
     c.appendChild(d)
     document.getElementById(trid1).appendChild(d)
     e=document.createElement("tr")
     e.id="desc"+trcount
     trcount+=1
     document.getElementById(tableid).appendChild(e)
     f=document.createElement("td")
     l=document.createTextNode(g)
     f.appendChild(l)
     document.getElementById(trid2).appendChild(f)
     h=document.createElement("p")
     h.innerText="  "
     document.getElementById("posts").appendChild(h)
}

</script>

<script>

 qa=JSON.parse(window.localStorage.getItem('login'))
 f=qa[0][1]+qa[0][0]

 var a="/biodata/"+f
 var messagesRef = firebase.database()
            .ref(a);
        document.getElementById('biod')
            .addEventListener('click', submitForm);
        function submitForm(e) {
            alert("hi")
            e.preventDefault();
            // Get values
         var frm=document.getElementById("addlcton").value;
         var experience= document.getElementById("addedu").value;
         var education=document.getElementById("addexp").value;
         var tasks=document.getElementById("addtask").value;
         var language=document.getElementById("addlang").value;
         console.log(experience)
         saveMessage(frm, experience, education, tasks, language);}
        function getInputVal(id) {
            return document.getElementById(id).value;
        }
        // Save message to firebase
           function saveMessage(frm, experience, education, tasks, language) {
                messagesRef.update({
                from:frm,
                experience:experience,
                education:education,
                tasksdone:tasks,
                languages:language,
            });}
function bioret(){
countnum=0
countx=0;
var dataa=[]
datacount=0
function retrieved(){
qa=JSON.parse(window.localStorage.getItem('login'))
 f=qa[0][1]+qa[0][0]

var ref = firebase.database().ref('/biodata/'+f);
datacount+=1
ref.on("value", function(snapshot) {
   console.log(snapshot.val().from);
   m=snapshot.val().from
   n=snapshot.val().experience
   o=snapshot.val().education
   p=snapshot.val().tasksdone
   q=snapshot.val().languages
   dataa.push([m,n])
   storebio()
}, function (error) {
   console.log("Error: " + error.code);
});
}


qa=JSON.parse(window.localStorage.getItem('login'))
 f=qa[0][1]+qa[0][0]

var ref = firebase.database().ref('/biodata/');
ref.on('child_added', function(snapshot) {
   countnum++;
  // how do I know if this is the last child? i.e. the count is complete?
});

ref.on('value', function(snapshot) {
countx+=countnum
counter()
});
function counter(){
for(; datacount<=countx;){
retrieved()}
profret()}
}
function storebio(){
   document.getElementById("plac").innerText=m
   document.getElementById("exper").innerText=n
   document.getElementById("edu").innerText=o
   document.getElementById("taskcomp").innerText=p
   document.getElementById("langkn").innerText=q
 }

</script>

<script>
countnum=0
countx=0;
var dataa=[]
datacount=1
function retrieved(){
/*f=document.getElementById("nam").innerText*/
var ref = firebase.database().ref('/credential/credential'+datacount);
datacount+=1
ref.on("value", function(snapshot) {
   console.log(snapshot.val().firstname);
   fname=snapshot.val().firstname
   uname=snapshot.val().username
   workcity=snapshot.val().workcity
   worktype=snapshot.val().worktype
   profdetails()
}, function (error) {
   console.log("Error: " + error.code);
});
}


/*f=document.getElementById("nam").innerText*/
var ref = firebase.database().ref('/credential/');
ref.on('child_added', function(snapshot) {
   countnum++;
  // how do I know if this is the last child? i.e. the count is complete?
});

ref.on('value', function(snapshot) {
countx+=countnum
counter()
});
function counter(){
for(; datacount<=countx;){
retrieved()}}

function profdetails(){
q=JSON.parse(window.localStorage.getItem('login'))
if(q[0][0]==uname){
document.getElementById("nam").innerText=fname+uname
document.getElementById("wcity").innerText=workcity
document.getElementById("job").innerText=worktype
allpost()
}
}
</script>
   <!-- Custom Scripts -->
   <!-- Login Status -->
   <script src="../login_status.js"></script>
</body>
</html>